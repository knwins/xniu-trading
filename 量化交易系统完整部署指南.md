# �� 量化交易系统部署指南

## 📋 系统概述
这是一个基于Python的量化交易系统，支持币安期货交易，包含完整的策略回测和实盘交易功能。

## 🎯 快速部署 (3步完成)

### 第一步：准备服务器
```bash
# 1. 上传部署脚本到服务器
scp centos_setup.sh user@your-server-ip:/home/user/

# 2. 登录服务器并执行
ssh user@your-server-ip
chmod +x centos_setup.sh
./centos_setup.sh
```

**⏱️ 执行时间**: 10-15分钟

### 第二步：配置API密钥
```bash
# 编辑交易配置
nano /opt/quant-trading/trading_config.json
```

填入您的币安API信息：
```json
{
  "api_key": "您的币安API_KEY",
  "secret_key": "您的币安SECRET_KEY",
  "symbol": "ETHUSDT",
  "initial_balance": 100.0,
  "max_position_size": 0.05,
  "stop_loss_pct": 0.02,
  "take_profit_pct": 0.05,
  "max_daily_loss": 0.05,
  "max_drawdown": 0.1,
  "signal_cooldown": 600,
  "base_url": "https://fapi.binance.com",
  "testnet": false
}
```

### 第三步：启动系统
```bash
# 启动交易系统
sudo systemctl start quant-trading
sudo systemctl enable quant-trading

# 检查状态
sudo systemctl status quant-trading
```

## 📁 系统目录结构

```
/opt/quant-trading/                    # 主目录
├── venv/                             # Python虚拟环境
├── logs/                             # 日志文件
│   ├── trading.log                   # 交易日志
│   └── error.log                     # 错误日志
├── trading_config.json               # 交易配置文件
│   ├── trading_config.json           # 实盘交易配置
│   └── small_trade_config.json       # 小额测试配置
├── data/                             # 数据文件
├── backups/                          # 备份文件
├── scripts/                          # 管理脚本
│   ├── start_trading.sh             # 启动脚本
│   ├── stop_trading.sh              # 停止脚本
│   ├── restart_trading.sh           # 重启脚本
│   ├── monitor.sh                   # 监控脚本
│   └── status.sh                    # 状态检查
└── src/                             # 源代码
    ├── trader.py                    # 交易核心
    ├── strategy.py                  # 交易策略
    ├── data_loader.py              # 数据加载
    ├── backtester.py               # 回测系统
    └── main.py                     # 主程序
```

## 🔧 日常管理命令

### 系统服务管理
```bash
# 启动/停止/重启
sudo systemctl start quant-trading
sudo systemctl stop quant-trading
sudo systemctl restart quant-trading

# 查看状态
sudo systemctl status quant-trading

# 查看实时日志
sudo journalctl -u quant-trading -f
```

### 快速监控
```bash
# 查看系统状态
cd /opt/quant-trading && ./scripts/status.sh

# 查看交易日志
tail -f logs/trading.log

# 查看错误日志
tail -f logs/error.log
```

## 📊 配置文件说明

### 实盘交易配置 (trading_config.json)
```json
{
  "api_key": "您的API_KEY",
  "secret_key": "您的SECRET_KEY",
  "symbol": "ETHUSDT",              // 交易对
  "initial_balance": 300.0,         // 初始资金
  "max_position_size": 0.1,         // 最大仓位比例
  "stop_loss_pct": 0.05,           // 止损百分比
  "take_profit_pct": 0.1,          // 止盈百分比
  "max_daily_loss": 0.1,           // 最大日亏损
  "max_drawdown": 0.2,             // 最大回撤
  "signal_cooldown": 300,          // 信号冷却时间(秒)
  "base_url": "https://fapi.binance.com"
}
```

### 小额测试配置 (small_trade_config.json)
```json
{
  "api_key": "您的API_KEY",
  "secret_key": "您的SECRET_KEY",
  "symbol": "ETHUSDT",
  "initial_balance": 100.0,         // 小额测试资金
  "max_position_size": 0.05,        // 更小的仓位
  "stop_loss_pct": 0.02,           // 更严格的止损
  "take_profit_pct": 0.05,         // 更保守的止盈
  "max_daily_loss": 0.05,          // 更严格的日亏损限制
  "max_drawdown": 0.1,             // 更严格的回撤限制
  "signal_cooldown": 600,          // 更长的冷却时间
  "base_url": "https://fapi.binance.com",
  "testnet": false                 // 是否使用测试网
}
```

## 🚨 故障排除

### 常见问题及解决方案

#### 1. 服务启动失败
```bash
# 查看详细错误信息
sudo journalctl -u quant-trading -n 50

# 检查配置文件
cat /opt/quant-trading/trading_config.json

# 检查Python环境
cd /opt/quant-trading && source venv/bin/activate && python --version
```

#### 2. API连接问题
```bash
# 测试网络连接
ping fapi.binance.com

# 测试API连接
cd /opt/quant-trading && python test_api_connection.py
```

#### 3. 权限问题
```bash
# 修复权限
sudo chown -R quant-trading:quant-trading /opt/quant-trading
sudo chmod +x /opt/quant-trading/scripts/*.sh
```

#### 4. 磁盘空间不足
```bash
# 检查磁盘空间
df -h

# 清理日志文件
sudo find /opt/quant-trading/logs -name "*.log" -mtime +7 -delete
```

### 问题排查顺序
1. ✅ 检查服务状态: `sudo systemctl status quant-trading`
2. ✅ 查看系统日志: `sudo journalctl -u quant-trading -n 20`
3. ✅ 查看应用日志: `tail -f /opt/quant-trading/logs/trading.log`
4. ✅ 运行状态检查: `/opt/quant-trading/scripts/status.sh`
5. ✅ 检查配置文件: `cat /opt/quant-trading/trading_config.json`

## 🔒 安全配置

### API密钥安全
- ✅ 设置IP白名单 (仅允许服务器IP)
- ✅ 仅启用期货交易权限
- ✅ 禁用提现权限
- ✅ 定期更换API密钥

### 服务器安全
- ✅ 使用SSH密钥登录
- ✅ 禁用root用户SSH登录
- ✅ 配置防火墙规则
- ✅ 定期更新系统

### 资金安全
- ✅ 先用小额资金测试 (建议100USDT以下)
- ✅ 设置合理的止损止盈
- ✅ 定期检查交易记录
- ✅ 监控账户余额变化

## 📈 系统监控

### 自动监控功能
- 🔄 实时交易状态监控
- 📊 账户余额变化监控
- ⚠️ 异常交易告警
- 📝 详细日志记录

### 手动监控命令
```bash
# 查看实时状态
watch -n 5 '/opt/quant-trading/scripts/status.sh'

# 监控日志变化
tail -f /opt/quant-trading/logs/trading.log | grep -E "(ERROR|WARNING|TRADE)"

# 查看系统资源
htop
```

## 🎉 部署完成检查清单

部署完成后，请确认以下项目：

### 基础环境 ✅
- [ ] Python 3.8+ 已安装
- [ ] 虚拟环境已创建
- [ ] 依赖包已安装
- [ ] 系统服务已配置

### 配置文件 ✅
- [ ] API密钥已配置
- [ ] 交易参数已设置
- [ ] 配置文件权限正确

### 系统服务 ✅
- [ ] 服务已启动
- [ ] 服务已设置为开机自启
- [ ] 日志文件正常生成

### 网络连接 ✅
- [ ] 币安API连接正常
- [ ] 网络延迟在可接受范围
- [ ] DNS解析正常

## 🚀 下一步操作

### 1. 策略开发
- 修改 `strategy.py` 开发新策略
- 使用 `backtester.py` 进行回测
- 分析策略性能

### 2. 系统优化
- 根据服务器性能调整参数
- 优化日志记录级别
- 添加更多监控指标

### 3. 功能扩展
- 添加邮件告警功能
- 集成Telegram通知
- 添加Web管理界面

## 📞 技术支持

如遇到问题，请按以下顺序排查：
1. 查看本文档的故障排除部分
2. 检查系统日志和错误信息
3. 确认网络连接和API配置
4. 联系技术支持

---

**🎯 恭喜！您的量化交易系统已成功部署并运行！** 

## 📝 更新日志

### v1.0.1 (2025-08-06)
- 版本更新
